(function(a){a.extend({popWin:function(b){function c(d){window.curWin=this;this.init=function(){if(document.getElementById("windows")){return}var g=document.documentElement.scrollHeight;a("body").append("<div id='windows' style='width:100%;height:"+g+"px;position:fixed;z-index:100;top:0px;left:0px'><div class='winbg' style='width:100%;height:100%;position:absolute;z-index:0;'></div><div id='winContainer' style='position:absolute;z-index:1;'></div></div>");this.container=document.getElementById("winContainer");this.draggable=(d.draggable!=null)?d.draggable:true;this.url=d.url;this.html=d.html;this.el=d.el;this.ajaxhtml=d.ajaxhtml;this.title=(d.title!=null)?d.title:"窗口";if(this.el!=null&&this.el!=undefined){this.elParent=a("#"+this.el).parent();this.cloneEl=a("#"+this.el).clone(true)}var f=d.width||600;var k=d.height||400;this.minWidth=d.minWidth||300;this.minHeight=d.minHeight||200;var j=(d.noborder)?"noborderwin":"dialogwin";this.WIN=window.curWin.creatElement(this.container,"div","","win "+j);if(!this.container.maxIndex){this.container.maxIndex=-1}this.WIN.style.zIndex=this.container.maxIndex;this.win=window.curWin.creatElement(this.WIN,"div","","");this.win.style.cssText="position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:1;";this.n=window.curWin.creatElement(this.win,"div","","n");this.n.innerHTML=this.title;this.e=window.curWin.creatElement(this.win,"div","","e");this.s_w_border=window.curWin.creatElement(this.win,"div","","s_w_border");this.s_b_border=window.curWin.creatElement(this.win,"div","","s_b_border");this.s=window.curWin.creatElement(this.win,"div","","s");this.c=window.curWin.creatElement(this.win,"div","","c");var e=d.left||Math.floor(Math.random()*(a("body").width()-f));var i=d.top||Math.floor(Math.random()*(a("body").height()-k));d.center=(d.center!=null)?d.center:false;if(d.center){var m=document.documentElement.clientWidth;var n=document.documentElement.clientHeight;e=(m-f-this.e.offsetWidth)/2;i=(n-k-(this.n.offsetHeight+this.s.offsetHeight+this.s_b_border.offsetHeight+this.s_w_border.offsetHeight))/2}if(e<0){e=0}if(i<0){i=0}this.WIN.style.top=i+"px";this.WIN.style.left=e+"px";this.WIN.style.width=(f+this.e.offsetWidth)+"px";this.WIN.style.height=(k+this.n.offsetHeight+this.s.offsetHeight+this.s_b_border.offsetHeight+this.s_w_border.offsetHeight)+"px";this.content=this.c;if(this.url){this.c.style.overflow="hidden";this.c.innerHTML='<iframe scrolling="yes" frameborder="0" width="100%" height="100%" allowtransparency="true" ></iframe>';this.content=this.c.firstChild;this.content.contentWindow.location.href=this.url;this.content.contentWindow.fromWin=this.fromWin;this.content.contentWindow.frameWin=this}if(this.el){this.c.insertBefore(document.getElementById(this.el),null);a("#"+this.el,this.c).css("display","")}if(this.html){this.c.innerHTML=this.html}if(this.ajaxhtml){a(this.content).load(this.ajaxhtml)}this.content.style.cssText="position:absolute;left:0px;top:0px;width:100%;height:100%;border:none";this.mask=window.curWin.creatElement(this.win,"div","","mask");this.mask.style.cssText="position:absolute;left:0px;top:0px;width:100%;height:100%;background:#000;filter:alpha(opacity=0);opacity:0.01;";a(this.mask).hide();this.WIN.mask=this.mask;this.close=window.curWin.creatElement(this.win,"div","","close");this.collapse=window.curWin.creatElement(this.win,"div","","collapse");this.close.obj=this.collapse.obj=this.WIN.obj=this.n.obj=this.content.obj=this;this.close.onclick=function(){this.obj.closeWin()};this.resize();a(window).resize(function(){var h=document.documentElement.scrollHeight;!!document.getElementById("windows")?document.getElementById("windows").style.height=window.curWin.px(h):""});this.WIN.style.display="none";if(this.draggable){a(this.WIN).draggable({handle:this.n,iframeFix:true,zero:true,stop:function(){var h=this.offsetTop;var q=this.offsetHeight;var p=this.offsetWidth;var o=this.offsetLeft;var r=document.documentElement.offsetWidth;var l=document.documentElement.clientHeight;if(h<0){this.style.top="0px"}if(q<=l){if(this.offsetTop>(l-q)){this.style.top=l-q+"px"}}else{this.style.top="0px"}if(o<0){this.style.left="0px"}if(o>(r-p)){this.style.left=r-p+"px"}}})}a(this.WIN).fadeIn("fast")};this.resize=function(e,f){if(e){this.WIN.style.width=window.curWin.px(e+this.e.offsetWidth)}if(f){this.WIN.style.height=window.curWin.px(f+this.n.offsetHeight+this.s.offsetHeight+this.s_b_border.offsetHeigh+this.s_w_border.offsetHeight)}e=this.WIN.offsetWidth;f=this.WIN.offsetHeight;if(this.n.offsetHeight==f||this.e.offsetWidth==e||this.s.offsetHeight==f||this.s_b_border.offsetHeight==f||this.s_w_border.offsetHeight==f){return false}this.n.style.left=0;this.n.style.width=window.curWin.px(e-this.e.offsetWidth);this.c.style.left=0;this.c.style.top=window.curWin.px(this.n.offsetHeight);this.c.style.width=window.curWin.px(e-this.e.offsetWidth);this.c.style.height=window.curWin.px(f-this.n.offsetHeight-this.s.offsetHeight-this.s_b_border.offsetHeight-this.s_w_border.offsetHeight);this.e.style.top=window.curWin.px(6);this.e.style.left=window.curWin.px(this.c.offsetWidth);this.e.style.height=window.curWin.px(f-6);this.s.style.left=window.curWin.px(6);this.s.style.top=window.curWin.px(this.n.offsetHeight+this.c.offsetHeight+this.s_b_border.offsetHeight+this.s_w_border.offsetHeight);this.s.style.width=window.curWin.px(e-this.e.offsetWidth-6);this.s_w_border.style.left=window.curWin.px(0);this.s_w_border.style.top=window.curWin.px(this.n.offsetHeight+this.c.offsetHeight);this.s_w_border.style.width=window.curWin.px(e-this.e.offsetWidth);this.s_b_border.style.left=window.curWin.px(0);this.s_b_border.style.top=window.curWin.px(this.n.offsetHeight+this.c.offsetHeight+this.s_w_border.offsetHeight);this.s_b_border.style.width=window.curWin.px(e-this.e.offsetWidth);this.mask.style.top=window.curWin.px(this.n.offsetHeight);this.mask.style.height=window.curWin.px(f-this.n.offsetHeight);return true};this.closeWin=function(){if(this.el!=null&&this.el!=undefined){a(this.cloneEl).appendTo(this.elParent)}a(this.WIN).fadeOut("fast",function(){a(this.WIN).remove();a("#windows").remove();window.curWin=null;window[this]=null})};this.setTitle=function(e){this.n.innerHTML=e;this.title=e};this.px=function(e){if(e<0){e=0}return e.toString()+"px"};this.creatElement=function(g,i,e,h){var f=document.createElement(i);g.appendChild(f);if(e!=""){f.id=e}if(h!=""){f.className=h}return f};this.options=d;this.init()}return new c(b)}})})(jQuery);